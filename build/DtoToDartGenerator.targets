<Project>
  <PropertyGroup>
    <!-- Allow users to customize the output directory -->
    <DartOutputDir Condition="'$(DartOutputDir)' == ''">$(MSBuildProjectDirectory)\generated_dart</DartOutputDir>
    <!-- Allow users to disable auto-generation -->
    <GenerateDartOnBuild Condition="'$(GenerateDartOnBuild)' == ''">true</GenerateDartOnBuild>
    <!-- Path to the tool executable in the NuGet package -->
    <DtoToDartGeneratorExe Condition="'$(DtoToDartGeneratorExe)' == ''">$(MSBuildThisFileDirectory)..\tools\net10.0\DtoToDartGenerator.dll</DtoToDartGeneratorExe>
  </PropertyGroup>

  <Target Name="GenerateDartFromDTOs" 
          AfterTargets="AfterBuild" 
          Condition="'$(GenerateDartOnBuild)' == 'true' and Exists('$(TargetPath)') and '$(DesignTimeBuild)' != 'true'">
    
    <Message Text="Running DTO-&gt;Dart generator for $(TargetPath)" Importance="High" />
    
    <!-- Run the packaged tool -->
    <Exec Command="dotnet &quot;$(DtoToDartGeneratorExe)&quot; &quot;$(TargetPath)&quot; &quot;$(DartOutputDir)&quot;" 
          ContinueOnError="false"
          IgnoreExitCode="false" />
    
    <Message Text="Dart files generated to: $(DartOutputDir)" Importance="High" />
  </Target>
</Project>
